-- =========================================================
--  SMART-DRAW AD ROTATOR (Auto-Scaling)
--  Fixes alignment by calculating screen size automatically.
-- =========================================================

-- 1. SETUP
local monitors = { peripheral.find("monitor") }
if #monitors == 0 then error("No Monitors Found!") end

-- 2. DRAWING TOOLS (The Magic Fix)
local function drawFullScreen(mon, bgColor)
    mon.setBackgroundColor(bgColor)
    mon.clear()
end

local function drawBox(mon, x, y, w, h, color)
    mon.setBackgroundColor(color)
    -- drawFilledBox uses absolute coordinates, so we do math here
    paintutils.drawFilledBox(x, y, x+w-1, y+h-1, color)
end

local function centerText(mon, y, text, txtColor, bgColor)
    local w, h = mon.getSize()
    if bgColor then 
        mon.setBackgroundColor(bgColor)
        -- Draw a full-width background strip for the text
        mon.setCursorPos(1, y)
        mon.write(string.rep(" ", w))
    end
    -- Calculate exact center
    local x = math.floor((w - #text) / 2) + 1
    mon.setCursorPos(x, y)
    mon.setTextColor(txtColor)
    mon.write(text)
end

-- 3. THE ADS (Procedurally Generated)

local function ad_reactor(mon)
    local w, h = mon.getSize()
    drawFullScreen(mon, colors.black)
    
    -- The Sun (Yellow Square in center)
    local sunSize = 8
    local sunX = math.floor((w - sunSize)/2) + 1
    local sunY = math.floor((h/2) - 6)
    drawBox(mon, sunX, sunY, sunSize, sunSize/2 + 2, colors.yellow)
    
    -- "Trash" Icon (Gray box below it)
    local binW = 10
    local binX = math.floor((w - binW)/2) + 1
    local binY = sunY + 8
    drawBox(mon, binX, binY, binW, 6, colors.gray)
    
    -- Text
    centerText(mon, 3, "THE SUN IS", colors.orange)
    centerText(mon, 5, "FIRED.", colors.red)
    
    centerText(mon, h-3, "WE HAVE THE POWER", colors.lightGray)
end

local function ad_minerals(mon)
    local w, h = mon.getSize()
    -- Blue Screen of Death Background
    drawFullScreen(mon, colors.blue)
    
    -- White Error Box
    local boxW = 20
    local boxH = 8
    local bx = math.floor((w - boxW)/2) + 1
    local by = math.floor((h - boxH)/2) + 1
    drawBox(mon, bx, by, boxW, boxH, colors.white)
    
    -- Text
    centerText(mon, 4, "ERROR 404", colors.white, colors.blue)
    centerText(mon, by+2, "ORES NOT", colors.blue, colors.white)
    centerText(mon, by+4, "FOUND", colors.blue, colors.white)
    
    centerText(mon, h-2, "WE TOOK THEM ALL", colors.white, colors.blue)
end

local function ad_subway(mon)
    local w, h = mon.getSize()
    drawFullScreen(mon, colors.red) -- Aggressive Red Background
    
    -- Big Black "Propaganda" Box
    local margin = 4
    drawBox(mon, margin, margin, w-(margin*2), h-(margin*2), colors.black)
    
    -- Text
    centerText(mon, 6, "OBEY", colors.white, colors.black)
    
    -- Green "Subway" strip
    local subY = math.floor(h/2) + 2
    drawBox(mon, margin, subY, w-(margin*2), 3, colors.green)
    centerText(mon, subY+1, "EAT FRESH", colors.white, colors.green)
    
    centerText(mon, h-5, "OR ELSE", colors.red, colors.black)
end

-- 4. MAIN LOOP
while true do
    -- Loop through every connected monitor
    for _, mon in ipairs(monitors) do
        mon.setTextScale(0.5) -- Force HD Mode
        term.redirect(mon)
        
        -- Run the ads directly
        ad_reactor(mon)
    end
    sleep(5)
    
    for _, mon in ipairs(monitors) do
        term.redirect(mon)
        ad_minerals(mon)
    end
    sleep(5)
    
    for _, mon in ipairs(monitors) do
        term.redirect(mon)
        ad_subway(mon)
    end
    sleep(5)
end
