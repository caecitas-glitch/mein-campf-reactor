-- =========================================================
--  MULTI-SCREEN AD ROTATOR (With Embedded EuroCorp Ad)
--  Resolution: 42x30 (Scale 0.5)
--  Supports: Multiple Monitors, Auto-Image Generation
-- =========================================================

-- 1. EMBEDDED IMAGE DATA (The "Picture You Sent")
-- This checks if minerals.nfp exists. If not, it creates it from this text.
local minerals_nfp_data = [[
77777777777777777b777777777777777777777777
7777777777777777bbb77777777777777777777777
7777777777bbbbbbbbbbbbb7777777777777777777
777777777bbbbbbbbbbbbbbb777777777777777777
77777777bbbbbbbbbbbbbbbbb77777777777777777
7777777bbbbbbbbbbbbbbbbbbb7777777777777777
7777777bbbbbbbbbbbbbbbbbbb7777777777777777
7777777bbbbbbbbbbbbbbbbbbb7777777777777777
7777777bbbbbbbbbbbbbbbbbbb7777777777777777
77777777bbbbbbbbbbbbbbbbb77777777777777777
777777777bbbbbbbbbbbbbbb777777777777777777
7777777777bbbbbbbbbbbbb7777777777777777777
777777777777bbbbbbbbb777777777777777777777
777777777777777777777777777777777777777777
777777777777777777777777777777777777777777
777777777777777777777777777777777777777777
777777777777777777777777777777777777777777
777777777777777777777777777777777777777777
777777777777777777777777777777777777777777
777777777777777777777777777777777777777777
777777777777777777777777777777777777777777
777777777777777777777777777777777777777777
777777777777777777777777777777777777777777
777777777777777777777777777777777777777777
000000000000000000000000000000000000000000
0ffff0f0f0ffff0fffff0ffff0ffff0fffff0ffff0
0f0000f0f0f00f00f0000f00f0f00f00f0000f00f0
0fff00f0f0f00f00f0000fff00f00f00f0000fff00
0f0000f0f0f00f00f0000f0f00f00f00f0000f0f00
0f0000f0f0f00f00f0000f00f0ffff00f0000f00f0
]]

local function install_images()
    if not fs.exists("minerals.nfp") then
        local file = fs.open("minerals.nfp", "w")
        file.write(minerals_nfp_data)
        file.close()
        print("created minerals.nfp")
    end
end

-- 2. FIND ALL MONITORS
-- This finds every monitor connected via wired modems
local monitors = { peripheral.find("monitor") }

if #monitors == 0 then
    error("No Monitors Found! Connect Wired Modems & Reboot.")
end

print("System Active: " .. #monitors .. " screens detected.")

-- 3. SETUP RESOLUTION (Apply to all screens)
install_images() -- Run the installer first
for _, mon in ipairs(monitors) do
    mon.setTextScale(0.5) -- Force 42x30 mode
    mon.setBackgroundColor(colors.black)
    mon.clear()
end

-- 4. DISPLAY FUNCTION (Syncs all screens)
local function showAd(filename, duration)
    -- Safety Check: Does file exist?
    if not fs.exists(filename) then
        -- Warn user in terminal, but don't crash the screens
        print("Skipping missing file: " .. filename)
        
        -- Flash 'Missing' briefly on screens so you know to fix it
        for _, mon in ipairs(monitors) do
            term.redirect(mon)
            mon.setCursorPos(1,1)
            mon.setTextColor(colors.red)
            mon.write("FILE MISSING: " .. filename)
        end
        sleep(2) 
        return
    end

    -- Load the image into RAM once
    local image = paintutils.loadImage(filename)

    -- Paint it onto EVERY monitor simultaneously
    for _, mon in ipairs(monitors) do
        term.redirect(mon)       -- Focus on this monitor
        mon.setBackgroundColor(colors.black)
        mon.clear()
        paintutils.drawImage(image, 1, 1) -- Draw the NFP image
    end
    
    -- Return control to main terminal
    term.redirect(term.native())
    sleep(duration)
end

-- 5. MAIN LOOP
while true do
    -- Ad 1: Reactor (You still need to make this file!)
    showAd("reactor.nfp", 10)
    
    -- Ad 2: Minerals (This one is auto-installed now!)
    showAd("minerals.nfp", 10)
    
    -- Ad 3: Subway (You still need to make this file!)
    showAd("subway.nfp", 10)
end
