-- SERVER SCRIPT (Run at the base of the elevator)
peripheral.find("modem", rednet.open)
local id = os.getComputerID()
print("Elevator Server Online (ID: " .. id .. ")")
print("Waiting for signals...")

-- CONFIGURATION
-- Connect your Redstone Links to these sides of the Computer
local floorMap = {
    [1] = "back",   -- Floor 1 (Lobby)
    [2] = "right",  -- Floor 2
    [3] = "left"    -- Floor 3
}

while true do
    -- Wait for a message
    local senderId, message = rednet.receive("elevator_cmd")
    
    if type(message) == "table" and message.floor then
        local target = message.floor
        local side = floorMap[target]
        
        if side then
            print("Command Received: Sending Elevators to Floor " .. target)
            
            -- Turn on the signal
            rs.setOutput(side, true)
            
            -- FIX FOR CALLING DOWN:
            -- Hold the signal for 4 seconds. This forces the elevator 
            -- to "wake up" and move, even if it's currently parked.
            sleep(4) 
            
            -- Turn off the signal
            rs.setOutput(side, false)
        else
            print("Error: No redstone side configured for Floor " .. target)
        end
    end
end
