-- SERVER SCRIPT (Save as startup.lua)
-- Run at the base of the elevator
peripheral.find("modem", rednet.open)
print("Elevator Server Online. ID: " .. os.getComputerID())
print("Waiting for signals...")

-- CONFIGURATION: Wiring
-- Connect your Redstone Links to these sides of the Computer
local floorMap = {
    [1] = "back",   -- Activates Floor 1
    [2] = "right",  -- Activates Floor 2
    [3] = "left"    -- Activates Floor 3
}

while true do
    -- 1. Listen for the signal
    local id, message = rednet.receive("elevator_cmd")
    
    -- 2. Verify the message
    if type(message) == "table" and message.floor then
        local target = message.floor
        local side = floorMap[target]
        
        if side then
            print("Received Call: Sending Elevator to Floor " .. target)
            
            -- 3. Turn ON the signal
            rs.setOutput(side, true)
            
            -- 4. HOLD signal for 4 seconds
            -- This ensures the elevator unlatches and moves even if "stuck"
            sleep(4) 
            
            -- 5. Turn OFF the signal
            rs.setOutput(side, false)
            print("Signal ended.")
        else
            print("Error: No side configured for Floor " .. target)
        end
    end
end
