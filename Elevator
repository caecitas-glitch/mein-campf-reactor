-- CLIENT SCRIPT (Auto-Detect Modem)
-- This loop checks EVERY side to find the modem
local sides = rs.getSides()
local modemFound = false

-- 1. Try to open modem on any side
for _, side in pairs(sides) do
    if peripheral.getType(side) == "modem" then
        -- We found a modem! Open it.
        rednet.open(side)
        modemFound = true
        break
    end
end

-- 2. Pocket Computer Fallback (Modem is internal/back)
if not modemFound then
    -- Pocket computers don't always show up in rs.getSides() the same way
    if pcall(rednet.open, "back") then
        modemFound = true
    end
end

-- 3. Crash if still no modem
if not modemFound then
    term.clear()
    term.setCursorPos(1,1)
    print("ERROR: No Wireless Modem Found!")
    print("Please check connection.")
    print("Current Side: RIGHT (Make sure it is clicked/connected)")
    error() -- Stop the program
end

-- CONFIGURATION
local floors = {
    [1] = "Lobby",
    [2] = "Storage",
    [3] = "Roof"
}

-- Detect Screen Type (Pocket vs Wall)
local mon = peripheral.find("monitor")
if not mon then 
    mon = term.current() -- Pocket Computer
else
    mon.setTextScale(1)  -- Wall Monitor
end

local function drawUI()
    mon.setBackgroundColor(colors.black)
    mon.clear()
    mon.setCursorPos(1,1)
    mon.setTextColor(colors.cyan)
    mon.write("== ELEVATOR ==")
    
    local w, h = mon.getSize()
    for i = 1, #floors do
        mon.setCursorPos(2, 2 + (i*2)) 
        mon.setTextColor(colors.white)
        mon.write("[" .. i .. "] " .. floors[i])
    end
    
    mon.setCursorPos(2, h-1)
    mon.setTextColor(colors.yellow)
    mon.write("Select Floor...")
end

while true do
    drawUI()
    
    local event, side, x, y = os.pullEvent()
    local selectedFloor = nil
    
    if event == "monitor_touch" or event == "mouse_click" then
        if y == 4 then selectedFloor = 1 end
        if y == 6 then selectedFloor = 2 end
        if y == 8 then selectedFloor = 3 end
    elseif event == "char" then
        selectedFloor = tonumber(side)
    end
    
    if selectedFloor and floors[selectedFloor] then
        mon.setCursorPos(1, 10)
        mon.setTextColor(colors.lime)
        mon.write(">> CALLING " .. selectedFloor .. " <<")
        
        rednet.broadcast({ floor = selectedFloor }, "elevator_cmd")
        sleep(2)
    end
end
