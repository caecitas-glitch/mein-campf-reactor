-- startup.lua
-- Works on Pocket Computers AND Wall Monitors
peripheral.find("modem", rednet.open)

local floors = {
    [1] = "Lobby",
    [2] = "Storage",
    [3] = "Roof"
}

-- Detect screen type
local mon = peripheral.find("monitor")
if not mon then 
    mon = term.current() -- Use Pocket Computer screen
else
    mon.setTextScale(1)  -- Use Wall Monitor screen
end

local function drawMenu()
    mon.setBackgroundColor(colors.black)
    mon.clear()
    mon.setCursorPos(1,1)
    mon.setTextColor(colors.cyan)
    mon.write("== ELEVATOR CONTROL ==")
    
    local w, h = mon.getSize()
    local spacer = math.floor(h / 4) -- Space buttons out evenly

    for i = 1, #floors do
        mon.setCursorPos(2, 2 + (i*2)) 
        mon.setTextColor(colors.white)
        mon.write("[" .. i .. "] " .. floors[i])
    end
    
    mon.setCursorPos(2, h)
    mon.setTextColor(colors.yellow)
    mon.write("Select Floor...")
end

while true do
    drawMenu()
    
    local event, side, x, y = os.pullEvent()
    local selectedFloor = nil

    -- 1. If you CLICK the screen (Pocket or Monitor)
    if event == "mouse_click" or event == "monitor_touch" then
        -- Simple math to find which button you clicked
        -- We drew them at Y positions: 4, 6, 8...
        -- This approximates the click to the floor number
        if y >= 4 and y <= 4 then selectedFloor = 1 end
        if y >= 6 and y <= 6 then selectedFloor = 2 end
        if y >= 8 and y <= 8 then selectedFloor = 3 end
    
    -- 2. If you TYPE the number (Pocket Computer only)
    elseif event == "char" then
        selectedFloor = tonumber(side)
    end

    -- Send the signal!
    if selectedFloor and floors[selectedFloor] then
        mon.setCursorPos(1, 3)
        mon.setTextColor(colors.lime)
        mon.write(">> CALLING FLOOR " .. selectedFloor .. " <<")
        
        -- Broadcast to ALL 4 Buildings
        rednet.broadcast({ floor = selectedFloor }, "elevator_cmd")
        
        sleep(2) -- Wait so you can read the text
    end
end
