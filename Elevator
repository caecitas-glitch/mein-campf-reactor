-- CLIENT SCRIPT (Run on Pocket Computer or Wall Screen)
peripheral.find("modem", rednet.open)

local floors = {
    [1] = "Lobby",
    [2] = "Storage",
    [3] = "Roof"
}

-- Check if we are a Pocket Computer or a Big Monitor
local mon = peripheral.find("monitor")
if not mon then 
    mon = term.current() -- Use built-in screen
else
    mon.setTextScale(1)  -- Use Wall Monitor
end

local function drawUI()
    mon.setBackgroundColor(colors.black)
    mon.clear()
    mon.setCursorPos(1,1)
    
    -- Header
    mon.setTextColor(colors.cyan)
    mon.write("== ELEVATOR ==")
    
    -- Draw Buttons
    local w, h = mon.getSize()
    for i = 1, #floors do
        -- Draw at lines 4, 6, 8
        mon.setCursorPos(2, 2 + (i*2)) 
        mon.setTextColor(colors.white)
        mon.write("[" .. i .. "] " .. floors[i])
    end
    
    -- Footer
    mon.setCursorPos(2, h-1)
    mon.setTextColor(colors.yellow)
    mon.write("Select Floor...")
end

while true do
    drawUI()
    
    local event, side, x, y = os.pullEvent()
    local selectedFloor = nil
    
    -- 1. Handle Touch (Monitor) or Mouse Click (Pocket)
    if event == "monitor_touch" or event == "mouse_click" then
        -- Map the Y-coordinate click to a floor number
        if y == 4 then selectedFloor = 1 end
        if y == 6 then selectedFloor = 2 end
        if y == 8 then selectedFloor = 3 end
        
    -- 2. Handle Keyboard Typing (Pocket Only)
    elseif event == "char" then
        selectedFloor = tonumber(side)
    end
    
    -- Send Command
    if selectedFloor and floors[selectedFloor] then
        mon.setCursorPos(1, 10)
        mon.setTextColor(colors.lime)
        mon.write(">> CALLING " .. selectedFloor .. " <<")
        
        -- Broadcast to ALL 4 Buildings simultaneously
        rednet.broadcast({ floor = selectedFloor }, "elevator_cmd")
        
        sleep(2) -- Cool down prevents spamming
    end
end
