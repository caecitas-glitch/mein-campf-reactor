-- CLIENT SCRIPT (Pocket & Wall)
-- 1. OPEN THE MODEM
-- We try "back" first (for Pocket Computers)
-- If that fails, we try "top" (Common for Wall Computers)
-- CHANGE "top" below if you placed your modem on the right/left/etc!
pcall(rednet.open, "back")
pcall(rednet.open, "top") 

-- 2. Verify connection
if not rednet.isOpen() then
    print("ERROR: No Modem Found!")
    print("Place a Wireless Modem on the Computer.")
    print("Pocket Computer: It is built-in (Back).")
    print("Wall Computer: Place it on Top/Side.")
    sleep(5)
    os.reboot()
end

-- CONFIGURATION
local floors = {
    [1] = "Lobby",
    [2] = "Storage",
    [3] = "Roof"
}

-- Detect Screen Type
local mon = peripheral.find("monitor")
if not mon then 
    mon = term.current() -- Pocket Computer
else
    mon.setTextScale(1)  -- Wall Monitor
end

local function drawUI()
    mon.setBackgroundColor(colors.black)
    mon.clear()
    mon.setCursorPos(1,1)
    mon.setTextColor(colors.cyan)
    mon.write("== ELEVATOR ==")
    
    local w, h = mon.getSize()
    for i = 1, #floors do
        mon.setCursorPos(2, 2 + (i*2)) 
        mon.setTextColor(colors.white)
        mon.write("[" .. i .. "] " .. floors[i])
    end
    
    mon.setCursorPos(2, h-1)
    mon.setTextColor(colors.yellow)
    mon.write("Select Floor...")
end

while true do
    drawUI()
    
    local event, side, x, y = os.pullEvent()
    local selectedFloor = nil
    
    if event == "monitor_touch" or event == "mouse_click" then
        if y == 4 then selectedFloor = 1 end
        if y == 6 then selectedFloor = 2 end
        if y == 8 then selectedFloor = 3 end
    elseif event == "char" then
        selectedFloor = tonumber(side)
    end
    
    if selectedFloor and floors[selectedFloor] then
        mon.setCursorPos(1, 10)
        mon.setTextColor(colors.lime)
        mon.write(">> CALLING " .. selectedFloor .. " <<")
        
        -- Broadcast Command
        rednet.broadcast({ floor = selectedFloor }, "elevator_cmd")
        sleep(2)
    end
end
